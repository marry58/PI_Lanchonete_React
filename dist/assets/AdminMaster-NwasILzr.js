import{r as d,ad as e,aC as i,b3 as _e,b4 as ae,b5 as ne,aZ as Ae,aS as te,b6 as Le,aX as Te,b2 as Ee,aW as re,b7 as ke,a_ as Ie,b0 as De,b1 as Fe}from"./vendor-WvxInmkI.js";import{f as oe,s as f,H as Re,g as ie,C as g,c as p,d as N,e as D,B as w,L as m,I as u,a as v}from"./index-BInAVXNB.js";import{T as ze,a as Pe,b as F,c as R}from"./tabs-akv-j3gh.js";import{T as z,a as P,b as j,c as l,d as H,e as r,S as He,f as Ue,g as Oe,h as Me,i as $e}from"./select-BKYq4roj.js";import{D as U,e as ce,a as O,b as M,c as $,d as q,f as B}from"./dialog-VvVZCG6g.js";import{m as le,n as qe}from"./radix-BvlS9Eci.js";import"./supabase-DuVauSO6.js";import"./react-query-D1LWqImO.js";const G=d.forwardRef(({className:b,...T},E)=>e.jsx(le,{className:oe("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",b),...T,ref:E,children:e.jsx(qe,{className:oe("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));G.displayName=le.displayName;const Qe=()=>{const[b,T]=d.useState([]),[E,k]=d.useState(!1),[de,V]=d.useState(!1),[he,I]=d.useState(!1),[W,X]=d.useState(null),[a,x]=d.useState({nome_lanchonete:"",endereco:"",telefone:"",horario:"",status:!0}),[Z,me]=d.useState([]),[xe,J]=d.useState(!1),[K,Q]=d.useState(!1),[ue,Y]=d.useState(!1),[o,_]=d.useState({nome:"",email:"",lanchoneteId:"",senha:""}),[y,ee]=d.useState({totalLanchonetes:2,totalAdmins:2,totalUsuarios:150,totalPedidos:450,receitaTotal:15750,pedidosHoje:28}),je=s=>{if(!s)return"Sem unidade";const n=b.find(t=>t.id===s);return(n==null?void 0:n.nome_lanchonete)||"Sem unidade"},fe=s=>s?new Date(s).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}):"-",C=d.useCallback(async()=>{k(!0);const{data:s,error:n}=await f.from("lanchonete").select("id, nome_lanchonete, endereco, telefone, horario, status").order("nome_lanchonete",{ascending:!0});if(n){console.error(n),i.error("Erro ao carregar lanchonetes."),k(!1);return}const t=(s||[]).map(c=>({id:c.id,nome_lanchonete:c.nome_lanchonete,endereco:c.endereco??"",telefone:c.telefone??"",horario:c.horario??"",status:c.status??!0}));T(t),ee(c=>({...c,totalLanchonetes:t.length})),k(!1)},[]),A=d.useCallback(async()=>{J(!0);try{const s=["admin"],{data:n,error:t}=await f.from("usuario").select("id, nome, email, role, metadata, created_at, auth_user_id, lanchonete_id").in("role",s).order("created_at",{ascending:!1});if(t)throw t;const c=(n||[]).map(h=>{var S,L;return{id:h.id,auth_user_id:h.auth_user_id,nome:h.nome??"Sem nome",email:h.email??"",lanchoneteId:h.lanchonete_id??((S=h.metadata)==null?void 0:S.lanchonete_id)??null,status:((L=h.metadata)==null?void 0:L.active)??!0,dataAdicao:h.created_at,metadata:h.metadata||{},role:h.role||"admin"}});me(c),ee(h=>({...h,totalAdmins:c.length}))}catch(s){console.error(s),i.error("Erro ao carregar admins.")}finally{J(!1)}},[]);d.useEffect(()=>{C(),A()},[C,A]);const ge=async s=>{if(s.preventDefault(),!a.nome_lanchonete||!a.endereco){i.error("Preencha nome e endereço da lanchonete!");return}try{const{error:n}=await f.from("lanchonete").insert({nome_lanchonete:a.nome_lanchonete,endereco:a.endereco,telefone:a.telefone,horario:a.horario,status:a.status});if(n)throw n;i.success("Lanchonete adicionada com sucesso!"),V(!1),x({nome_lanchonete:"",endereco:"",telefone:"",horario:"",status:!0}),C()}catch(n){console.error(n),i.error("Erro ao salvar lanchonete.")}},pe=s=>{X(s),x({nome_lanchonete:s.nome_lanchonete,endereco:s.endereco,telefone:s.telefone,horario:s.horario,status:s.status}),I(!0)},Ne=async()=>{if(!a.nome_lanchonete||!a.endereco||!W){i.error("Preencha nome e endereço da lanchonete!");return}try{const{error:s}=await f.from("lanchonete").update({nome_lanchonete:a.nome_lanchonete,endereco:a.endereco,telefone:a.telefone,horario:a.horario,status:a.status}).eq("id",W.id);if(s)throw s;i.success("Lanchonete atualizada com sucesso!"),I(!1),X(null),x({nome_lanchonete:"",endereco:"",telefone:"",horario:"",status:!0}),C()}catch(s){console.error(s),i.error("Erro ao atualizar lanchonete.")}},ve=async s=>{try{const{error:n}=await f.from("lanchonete").delete().eq("id",s);if(n)throw n;i.success("Lanchonete removida!"),C()}catch(n){console.error(n),i.error("Erro ao remover lanchonete.")}},be=async s=>{const n=b.find(t=>t.id===s);if(n)try{const{error:t}=await f.from("lanchonete").update({status:!n.status}).eq("id",s);if(t)throw t;i.success("Status atualizado!"),C()}catch(t){console.error(t),i.error("Erro ao atualizar status.")}},we=async s=>{var n;if(s.preventDefault(),!o.nome||!o.email||!o.senha||!o.lanchoneteId){i.error("Preencha todos os campos obrigatórios!");return}try{Q(!0);const{data:t,error:c}=await f.auth.signUp({email:o.email,password:o.senha,options:{data:{full_name:o.nome,role:"admin",lanchonete_id:o.lanchoneteId},emailRedirectTo:`${window.location.origin}/login`}});if(c)throw c;const h=(n=t.user)==null?void 0:n.id;if(!h)throw new Error("Não foi possível obter o ID do usuário criado.");const S=b.find(Se=>Se.id===o.lanchoneteId),L=(S==null?void 0:S.nome_lanchonete)||"",{error:se}=await f.from("usuario").insert({auth_user_id:h,nome:o.nome,email:o.email,role:"admin",unidade:L,lanchonete_id:o.lanchoneteId,metadata:{active:!0,lanchonete_id:o.lanchoneteId}});if(se)throw se;i.success("Administrador criado com sucesso!"),Y(!1),_({nome:"",email:"",lanchoneteId:"",senha:""}),A()}catch(t){console.error(t),i.error(t.message||"Erro ao criar administrador.")}finally{Q(!1)}},ye=async s=>{const n=!s.status;try{const t={...s.metadata||{},active:n},{error:c}=await f.from("usuario").update({metadata:t}).eq("id",s.id);if(c)throw c;i.success("Status do admin atualizado!"),A()}catch(t){console.error(t),i.error("Erro ao atualizar status do admin.")}},Ce=async s=>{try{const n={...s.metadata||{},lanchonete_id:null,active:!1},{error:t}=await f.from("usuario").update({role:"client",metadata:n}).eq("id",s.id);if(t)throw t;i.success("Admin removido!"),A()}catch(n){console.error(n),i.error("Erro ao remover admin.")}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Re,{}),e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Painel Master"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerenciamento geral do sistema"})]}),e.jsxs(ie,{variant:"outline",className:"gap-2",children:[e.jsx(_e,{className:"h-4 w-4"}),"Master Admin"]})]}),e.jsxs(ze,{defaultValue:"lanchonetes",className:"space-y-6",children:[e.jsxs(Pe,{className:"grid w-full grid-cols-3",children:[e.jsxs(F,{value:"lanchonetes",className:"gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Lanchonetes"]}),e.jsxs(F,{value:"admins",className:"gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Admins"]}),e.jsxs(F,{value:"estatisticas",className:"gap-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),"Estatísticas"]})]}),e.jsx(R,{value:"lanchonetes",className:"space-y-4",children:e.jsxs(g,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Gerenciar Lanchonetes"}),e.jsx(D,{children:"Cadastre e gerencie as lanchonetes do sistema"})]}),e.jsxs(U,{open:de,onOpenChange:V,children:[e.jsx(ce,{asChild:!0,children:e.jsxs(w,{className:"gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Nova Lanchonete"]})}),e.jsxs(O,{children:[e.jsxs(M,{children:[e.jsx($,{children:"Adicionar Lanchonete"}),e.jsx(q,{children:"Cadastre uma nova lanchonete no sistema"})]}),e.jsxs("form",{onSubmit:ge,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"nome_lanchonete",children:"Nome *"}),e.jsx(u,{id:"nome_lanchonete",value:a.nome_lanchonete,onChange:s=>x({...a,nome_lanchonete:s.target.value}),placeholder:"Nome da lanchonete"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"endereco",children:"Endereço *"}),e.jsx(u,{id:"endereco",value:a.endereco,onChange:s=>x({...a,endereco:s.target.value}),placeholder:"Endereço completo"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"telefone",children:"Telefone"}),e.jsx(u,{id:"telefone",value:a.telefone,onChange:s=>x({...a,telefone:s.target.value}),placeholder:"(00) 0000-0000"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"horario",children:"Horário de Funcionamento"}),e.jsx(u,{id:"horario",value:a.horario,onChange:s=>x({...a,horario:s.target.value}),placeholder:"Ex: 8h - 18h"})]}),e.jsx(B,{children:e.jsx(w,{type:"submit",children:"Adicionar"})})]})]})]})]})}),e.jsx(v,{children:e.jsxs(z,{children:[e.jsx(P,{children:e.jsxs(j,{children:[e.jsx(l,{children:"Nome"}),e.jsx(l,{children:"Endereço"}),e.jsx(l,{children:"Telefone"}),e.jsx(l,{children:"Horário"}),e.jsx(l,{children:"Status"}),e.jsx(l,{className:"text-right",children:"Ações"})]})}),e.jsx(H,{children:E?e.jsx(j,{children:e.jsx(r,{colSpan:6,className:"text-center text-sm text-muted-foreground",children:"Carregando lanchonetes..."})}):b.length===0?e.jsx(j,{children:e.jsx(r,{colSpan:6,className:"text-center text-sm text-muted-foreground",children:"Nenhuma lanchonete cadastrada."})}):b.map(s=>e.jsxs(j,{children:[e.jsx(r,{className:"font-medium",children:s.nome_lanchonete}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4 text-muted-foreground"}),s.endereco]})}),e.jsx(r,{children:s.telefone}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4 text-muted-foreground"}),s.horario]})}),e.jsx(r,{children:e.jsx(G,{checked:s.status,onCheckedChange:()=>be(s.id)})}),e.jsx(r,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>pe(s),children:e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>ve(s.id),children:e.jsx(re,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})}),e.jsx(R,{value:"admins",className:"space-y-4",children:e.jsxs(g,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Gerenciar Administradores"}),e.jsx(D,{children:"Gerencie os admins de cada lanchonete"})]}),e.jsxs(U,{open:ue,onOpenChange:Y,children:[e.jsx(ce,{asChild:!0,children:e.jsxs(w,{className:"gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Novo Admin"]})}),e.jsxs(O,{children:[e.jsxs(M,{children:[e.jsx($,{children:"Adicionar Administrador"}),e.jsx(q,{children:"Cadastre um novo administrador"})]}),e.jsxs("form",{onSubmit:we,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"admin-nome",children:"Nome *"}),e.jsx(u,{id:"admin-nome",value:o.nome,onChange:s=>_({...o,nome:s.target.value}),placeholder:"Nome completo"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"admin-email",children:"Email *"}),e.jsx(u,{id:"admin-email",type:"email",value:o.email,onChange:s=>_({...o,email:s.target.value}),placeholder:"email@exemplo.com"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"admin-senha",children:"Senha *"}),e.jsx(u,{id:"admin-senha",type:"password",value:o.senha,onChange:s=>_({...o,senha:s.target.value}),placeholder:"Senha do admin"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"lanchonete",children:"Lanchonete *"}),e.jsxs(He,{value:o.lanchoneteId,onValueChange:s=>_({...o,lanchoneteId:s}),children:[e.jsx(Ue,{children:e.jsx(Oe,{placeholder:"Selecione uma lanchonete"})}),e.jsx(Me,{children:b.map(s=>e.jsx($e,{value:s.id,children:s.nome_lanchonete},s.id))})]})]}),e.jsx(B,{children:e.jsx(w,{type:"submit",disabled:K,children:K?"Salvando...":"Adicionar"})})]})]})]})]})}),e.jsx(v,{children:e.jsxs(z,{children:[e.jsx(P,{children:e.jsxs(j,{children:[e.jsx(l,{children:"Nome"}),e.jsx(l,{children:"Email"}),e.jsx(l,{children:"Lanchonete"}),e.jsx(l,{children:"Data de Adição"}),e.jsx(l,{children:"Status"}),e.jsx(l,{className:"text-right",children:"Ações"})]})}),e.jsx(H,{children:xe?e.jsx(j,{children:e.jsx(r,{colSpan:6,className:"text-center text-sm text-muted-foreground",children:"Carregando administradores..."})}):Z.length===0?e.jsx(j,{children:e.jsx(r,{colSpan:6,className:"text-center text-sm text-muted-foreground",children:"Nenhum administrador cadastrado."})}):Z.map(s=>e.jsxs(j,{children:[e.jsx(r,{className:"font-medium",children:s.nome}),e.jsx(r,{children:s.email}),e.jsx(r,{children:e.jsx(ie,{variant:"secondary",children:je(s.lanchoneteId)})}),e.jsx(r,{children:fe(s.dataAdicao)}),e.jsx(r,{children:e.jsx(G,{checked:s.status,onCheckedChange:()=>ye(s)})}),e.jsx(r,{className:"text-right",children:e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>Ce(s),children:e.jsx(re,{className:"h-4 w-4"})})})]},s.id))})]})})]})}),e.jsxs(R,{value:"estatisticas",className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs(g,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total de Lanchonetes"}),e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:y.totalLanchonetes}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Unidades ativas"})]})]}),e.jsxs(g,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total de Admins"}),e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:y.totalAdmins}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Administradores ativos"})]})]}),e.jsxs(g,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total de Usuários"}),e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:y.totalUsuarios}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Clientes cadastrados"})]})]}),e.jsxs(g,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total de Pedidos"}),e.jsx(Ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:y.totalPedidos}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",y.pedidosHoje," hoje"]})]})]}),e.jsxs(g,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Receita Total"}),e.jsx(De,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["R$ ",y.receitaTotal.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Todas as lanchonetes"})]})]}),e.jsxs(g,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Crescimento"}),e.jsx(Fe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"+12.5%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Comparado ao mês anterior"})]})]})]}),e.jsxs(g,{children:[e.jsxs(p,{children:[e.jsx(N,{children:"Desempenho por Lanchonete"}),e.jsx(D,{children:"Comparativo de vendas entre unidades"})]}),e.jsx(v,{children:e.jsxs(z,{children:[e.jsx(P,{children:e.jsxs(j,{children:[e.jsx(l,{children:"Lanchonete"}),e.jsx(l,{children:"Pedidos"}),e.jsx(l,{children:"Receita"}),e.jsx(l,{children:"Ticket Médio"})]})}),e.jsxs(H,{children:[e.jsxs(j,{children:[e.jsx(r,{className:"font-medium",children:"Lanchonete Centro"}),e.jsx(r,{children:"280"}),e.jsx(r,{children:"R$ 9.450,00"}),e.jsx(r,{children:"R$ 33,75"})]}),e.jsxs(j,{children:[e.jsx(r,{className:"font-medium",children:"Lanchonete Campus Norte"}),e.jsx(r,{children:"170"}),e.jsx(r,{children:"R$ 6.300,00"}),e.jsx(r,{children:"R$ 37,06"})]})]})]})})]})]})]})]}),e.jsx(U,{open:he,onOpenChange:I,children:e.jsxs(O,{children:[e.jsxs(M,{children:[e.jsx($,{children:"Editar Lanchonete"}),e.jsx(q,{children:"Atualize as informações da lanchonete"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-nome",children:"Nome *"}),e.jsx(u,{id:"edit-nome",value:a.nome_lanchonete,onChange:s=>x({...a,nome_lanchonete:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-endereco",children:"Endereço *"}),e.jsx(u,{id:"edit-endereco",value:a.endereco,onChange:s=>x({...a,endereco:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-telefone",children:"Telefone"}),e.jsx(u,{id:"edit-telefone",value:a.telefone,onChange:s=>x({...a,telefone:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-horario",children:"Horário de Funcionamento"}),e.jsx(u,{id:"edit-horario",value:a.horario,onChange:s=>x({...a,horario:s.target.value})})]})]}),e.jsx(B,{children:e.jsx(w,{onClick:Ne,children:"Salvar Alterações"})})]})})]})};export{Qe as default};
