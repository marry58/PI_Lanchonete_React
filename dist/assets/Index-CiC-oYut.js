import{ad as e,aS as _,r as o,aB as B,aT as A,aD as D,aC as n}from"./vendor-WvxInmkI.js";import{C as R,a as U,b as $,B as j,s as v,u as z,H,I as K}from"./index-BInAVXNB.js";import{T as V,a as X,b as G,c as J}from"./tabs-akv-j3gh.js";import"./supabase-DuVauSO6.js";import"./radix-BvlS9Eci.js";import"./react-query-D1LWqImO.js";const M="/assets/logos-Footer-sistema-fecomercio-sesc-senac-DjFKkdBX.png",O=()=>e.jsx("footer",{className:"bg-white border-t",children:e.jsx("div",{className:"container flex items-center justify-center",children:e.jsx("img",{src:M,alt:"Fecomércio PR, Sesc, Senac e IFPD",className:" object-contain"})})}),Q=({name:c,description:i,price:d,image:m,onAddToCart:l})=>e.jsxs(R,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"aspect-square overflow-hidden bg-muted",children:e.jsx("img",{src:m,alt:c,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300"})}),e.jsxs(U,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:c}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:i}),e.jsxs("p",{className:"text-primary font-bold text-xl",children:["R$ ",d.toFixed(2)]})]}),e.jsx($,{className:"p-4 pt-0",children:e.jsxs(j,{className:"w-full",onClick:l,children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Adicionar"]})})]});console.log("Supabase URL:",v.supabaseUrl);const oe=()=>{const[c,i]=o.useState(""),[d,m]=o.useState([]),[l,N]=o.useState(["todos"]),[S,g]=o.useState(!0),[r,b]=o.useState(void 0),[u,x]=o.useState(null),[f,y]=o.useState(!1),{addItem:E}=z(),P=B(),L=async a=>{if(!a)return[];const{data:s,error:t}=await v.from("produtos").select(`
        id,
        nome,
        descricao,
        preco,
        imagem,
        categoria_id,
        categorias (
          id,
          nomeCategoria
        )
      `).eq("lanchonete_id",a).order("nome",{ascending:!0});return t?(console.error("Erro ao buscar produtos:",t),n.error("Erro ao carregar produtos!"),[]):s},T=async a=>{if(!a)return null;const{data:s,error:t}=await v.from("lanchonete").select("id, nome_lanchonete, endereco").eq("id",a).single();return t?(console.error("Erro ao carregar lanchonete:",t),n.error("Não foi possível carregar a lanchonete selecionada."),null):s};o.useEffect(()=>{if(typeof window>"u")return;const a=window.localStorage.getItem("lanchonete_selecionada");b(a),y(!0)},[]),o.useEffect(()=>{if(!f)return;if(!r){m([]),N(["todos"]),x(null),g(!1);return}(async()=>{g(!0);try{const[s,t]=await Promise.all([L(r),T(r)]);m(s),x(t);const h=s.map(F=>{var C;return((C=F.categorias)==null?void 0:C.nomeCategoria)||"sem categoria"}),q=["todos",...new Set(h)];N(q)}catch(s){console.error("Erro ao carregar dados:",s),n.error("Erro ao carregar cardápio da lanchonete.")}finally{g(!1)}})()},[f,r]);const k=()=>{typeof window<"u"&&(window.localStorage.removeItem("lanchonete_selecionada"),window.dispatchEvent(new Event("lanchonete_change"))),b(void 0),x(null),i(""),P("/inicio")},p=d.filter(a=>a.nome.toLowerCase().includes(c.toLowerCase())),w=a=>a==="todos"?p:p.filter(s=>{var h;return(((h=s.categorias)==null?void 0:h.nomeCategoria)||"sem categoria")===a}),I=async a=>{try{const s=await E({id:a.id,name:a.nome,description:a.descricao||"",price:Number(a.preco)||0,image:a.imagem});s!=null&&s.success?n.success(`${a.nome} adicionado ao carrinho!`):n.error((s==null?void 0:s.availableStock)>0?`Estoque disponível: ${s.availableStock} unidade(s).`:"Produto sem estoque disponível.")}catch(s){console.error("Erro ao adicionar ao carrinho",s),n.error("Não foi possível verificar o estoque agora.")}};return S?e.jsx("p",{className:"text-center mt-20",children:"Carregando..."}):(console.log("Produtos carregados:",d),console.log("Categorias disponíveis:",l),console.log("Produtos filtrados:",p),e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(H,{}),e.jsxs("main",{className:"container mx-auto px-4 py-8 flex-1 w-full",children:[e.jsxs("div",{className:"mb-8 space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold",children:"Cardápio"}),u&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Unidade selecionada: ",e.jsx("span",{className:"font-semibold text-foreground",children:u.nome_lanchonete}),u.endereco&&` • ${u.endereco}`]})]}),r&&e.jsx(j,{variant:"outline",className:"w-full sm:w-auto",onClick:k,children:"Trocar lanchonete"})]}),e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-5 w-5"}),e.jsx(K,{type:"text",placeholder:r?"Buscar produtos...":"Selecione uma lanchonete para buscar",value:c,onChange:a=>i(a.target.value),className:"pl-10",disabled:!r})]})]}),f&&!r?e.jsxs("div",{className:"rounded-md border border-dashed p-8 text-center",children:[e.jsx("p",{className:"mb-4 text-muted-foreground",children:"Escolha uma lanchonete para visualizar o cardápio disponível."}),e.jsx(j,{asChild:!0,children:e.jsx(D,{to:"/inicio",children:"Selecionar Lanchonete"})})]}):e.jsxs(V,{defaultValue:"todos",className:"w-full",children:[e.jsx(X,{className:"mb-8",children:l.map(a=>e.jsx(G,{value:a,children:a.charAt(0).toUpperCase()+a.slice(1)},a))}),l.map(a=>e.jsx(J,{value:a,children:w(a).length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum produto disponível nesta categoria."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:w(a).map(s=>e.jsx(Q,{name:s.nome,description:s.descricao||"",price:Number(s.preco)||0,image:s.imagem,onAddToCart:()=>I(s)},s.id))})},a))]})]}),e.jsx(O,{})]}))};export{oe as default};
