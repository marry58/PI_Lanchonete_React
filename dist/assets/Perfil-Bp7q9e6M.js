import{r as d,ad as e,aF as R,aX as H,aY as L,aC as n}from"./vendor-WvxInmkI.js";import{H as O,C as m,c as C,d as w,a as x,L as u,I as h,B as U,s as o}from"./index-BInAVXNB.js";import{T as B,a as $,b as P,c as D}from"./tabs-akv-j3gh.js";import{D as M,a as z,b as A,c as Q}from"./dialog-VvVZCG6g.js";import"./supabase-DuVauSO6.js";import"./radix-BvlS9Eci.js";import"./react-query-D1LWqImO.js";const Z=()=>{const[p,I]=d.useState([]),[t,j]=d.useState(null),[E,S]=d.useState([]),[_,f]=d.useState(!1),[l,g]=d.useState({nome:"",email:"",telefone:""});d.useEffect(()=>{(async()=>{const{data:a}=await o.auth.getUser();if(!(a!=null&&a.user)){n.error("Usuário não autenticado");return}const r=a.user.id,{data:c,error:v}=await o.from("usuario").select("nome, email, telefone").eq("auth_user_id",r).single();if(v){console.log(v),n.error("Erro ao carregar perfil");return}g({nome:c.nome,email:c.email,telefone:c.telefone});const{data:k,error:y}=await o.from("pedidos").select("*").eq("auth_user_id",r).order("created_at",{ascending:!1});y?console.log(y):I(k||[])})()},[]);const T=async s=>{f(!0);const{data:a,error:r}=await o.from("pedido_items").select("id, title, price, qty, metadata").eq("pedido_id",s);r?(console.log(r),n.error("Erro ao carregar itens do pedido")):S(a||[]),f(!1)},q=s=>{j(s),T(s.id)},N=s=>new Date(s).toLocaleDateString("pt-BR"),b=s=>({pending:"Pendente",preparing:"Preparando",ready:"Pronto",delivered:"Entregue",cancelled:"Cancelado"})[s]||s,i=s=>{g(a=>({...a,[s.target.id]:s.target.value}))},F=async()=>{const{data:s}=await o.auth.getUser(),a=s.user.id,{error:r}=await o.from("usuario").update({nome:l.nome,email:l.email,telefone:l.telefone}).eq("auth_user_id",a);if(r){console.log(r),n.error("Erro ao salvar");return}n.success("Informações atualizadas com sucesso!")};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(O,{}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsxs("h1",{className:"text-3xl font-bold mb-8",children:["Ola!",e.jsx("br",{}),l.nome]}),e.jsxs(B,{defaultValue:"dados",className:"space-y-6",children:[e.jsxs($,{className:"grid w-full max-w-md grid-cols-2",children:[e.jsxs(P,{value:"dados",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Dados"]}),e.jsxs(P,{value:"pedidos",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Pedidos"]})]}),e.jsx(D,{value:"dados",children:e.jsxs(m,{children:[e.jsx(C,{children:e.jsx(w,{children:"Informações Pessoais"})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"nome",children:"Nome completo"}),e.jsx(h,{id:"nome",value:l.nome,onChange:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"email",children:"Email"}),e.jsx(h,{id:"email",type:"email",value:l.email,onChange:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"telefone",children:"Telefone"}),e.jsx(h,{id:"telefone",type:"tel",value:l.telefone,onChange:i})]}),e.jsx(U,{onClick:F,children:"Salvar Alterações"})]})]})}),e.jsx(D,{value:"pedidos",children:e.jsxs(m,{children:[e.jsx(C,{children:e.jsx(w,{children:"Histórico de Pedidos"})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-4",children:p.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Nenhum pedido encontrado"}):p.map(s=>e.jsx(m,{className:"border cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>q(s),children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold flex items-center gap-2",children:["Pedido #",s.id.slice(0,8),e.jsx(L,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:N(s.created_at)})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-primary",children:["R$ ",Number(s.total).toFixed(2)]}),e.jsx("span",{className:"inline-block mt-1 px-2 py-1 bg-success/10 text-success text-xs rounded",children:b(s.status)})]})]})})},s.id))})})]})}),e.jsx(M,{open:!!t,onOpenChange:()=>j(null),children:e.jsxs(z,{className:"max-w-md",children:[e.jsx(A,{children:e.jsxs(Q,{children:["Detalhes do Pedido #",t==null?void 0:t.id.slice(0,8)]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Data: ",t&&N(t.created_at)]}),e.jsxs("p",{children:["Status: ",t&&b(t.status)]}),e.jsxs("p",{children:["Endereço: ",(t==null?void 0:t.address)||"Retirada no balcão"]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Itens do Pedido"}),_?e.jsx("p",{className:"text-muted-foreground",children:"Carregando..."}):e.jsx("div",{className:"space-y-2",children:E.map(s=>{var a;return e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[((a=s.metadata)==null?void 0:a.image)&&e.jsx("img",{src:s.metadata.image,alt:s.title,className:"w-10 h-10 rounded object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.title||"Produto"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Qtd: ",s.qty]})]})]}),e.jsxs("p",{className:"font-semibold",children:["R$ ",(Number(s.price)*s.qty).toFixed(2)]})]},s.id)})})]}),e.jsxs("div",{className:"border-t pt-4 flex justify-between font-bold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-primary",children:["R$ ",t&&Number(t.total).toFixed(2)]})]})]})]})})]})]})]})};export{Z as default};
